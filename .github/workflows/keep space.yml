name: é«˜çº§HFç©ºé—´ç›‘æ§å™¨

on:
  schedule:
    - cron: '0 1,7,13,19 * * *'
  workflow_dispatch:
    inputs:
      debug_mode:
        description: 'å¯ç”¨è°ƒè¯•æ¨¡å¼'
        required: false
        type: boolean
        default: false

env:
  RETRY_ATTEMPTS: 3
  TIMEOUT_SECONDS: 30
  SPACES_TO_MONITOR: |
    achm|https://latlpa-achm.hf.space
    agmn|https://latlpa-agmn.hf.space
    ngld|https://latlpa-ngld.hf.space

jobs:
  prepare:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-matrix.outputs.matrix }}
      spaces_list: ${{ steps.set-matrix.outputs.spaces_list }}
    steps:
      - name: å‡†å¤‡ç›‘æ§çŸ©é˜µ
        id: set-matrix
        run: |
          echo "ğŸ“‹ å‡†å¤‡ç›‘æ§åˆ—è¡¨..."
          matrix_json='{"space":['
          spaces_list=""
          first=true
          count=0
          while IFS= read -r line; do
            if [ -n "$line" ] && [[ ! "$line" =~ ^[[:space:]]*# ]]; then
              IFS='|' read -r name url <<< "$line"
              name=$(echo "$name" | xargs)
              url=$(echo "$url" | xargs)
              if [ -n "$name" ] && [ -n "$url" ]; then
                if [ "$first" = true ]; then
                  first=false
                else
                  matrix_json+=','
                  spaces_list+='\n'
                fi
                matrix_json+="{\"name\":\"$name\",\"url\":\"$url\"}"
                spaces_list+="- **${name}**: ${url}"
                count=$((count + 1))
                echo "âœ… æ·»åŠ ç›‘æ§: $name - $url"
              fi
            fi
          done <<< "$SPACES_TO_MONITOR"
          matrix_json+=']}'
          echo "matrix=$matrix_json" >> $GITHUB_OUTPUT
          echo "spaces_list<<EOF" >> $GITHUB_OUTPUT
          echo -e "$spaces_list" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
          echo "ğŸ“Š æ€»å…±å‡†å¤‡ç›‘æ§ $count ä¸ªç©ºé—´"
          if [ "${{ inputs.debug_mode }}" = "true" ]; then
            echo "ğŸ” è°ƒè¯•æ¨¡å¼å·²å¯ç”¨"
            echo "ç”Ÿæˆçš„çŸ©é˜µ: $matrix_json"
          fi

  monitor_spaces:
    needs: prepare
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    strategy:
      fail-fast: false
      matrix: ${{fromJson(needs.prepare.outputs.matrix)}}
    continue-on-error: true
    steps:
      - name: å‡†å¤‡ç›‘æ§ç¯å¢ƒ
        run: |
          echo "ğŸ“Š ç›‘æ§å¼€å§‹äº $(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S CST')"
          echo "ğŸ¯ ç›®æ ‡ç©ºé—´: ${{ matrix.space.name }}"
          echo "ğŸ”— URL: ${{ matrix.space.url }}"
          echo "TARGET_URL=${{ matrix.space.url }}" >> $GITHUB_ENV
          echo "SPACE_NAME=${{ matrix.space.name }}" >> $GITHUB_ENV
          if [ "${{ inputs.debug_mode }}" = "true" ]; then
            echo "ğŸ” è°ƒè¯•æ¨¡å¼: æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—"
          fi

      - name: å¥åº·æ£€æŸ¥ä¸æŒ‡æ ‡æ”¶é›†
        id: health_check
        continue-on-error: true
        run: |
          URL="${{ matrix.space.url }}"
          SUCCESS=false
          RESPONSE_TIME=""
          HTTP_CODE=""
          sudo apt-get update && sudo apt-get install -y bc > /dev/null 2>&1
          for attempt in 1 2 3; do
            echo "ğŸ”„ è¯·æ±‚å°è¯• #$attempt/3"
            START_TIME=$(date +%s%N)
            if response=$(curl -sSf -o /dev/null -w '%{json}' \
              --max-time ${{ env.TIMEOUT_SECONDS }} \
              --connect-timeout 10 \
              -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36" \
              -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" \
              -H "Accept-Language: en-US,en;q=0.9" \
              -H "Cache-Control: no-cache" \
              "$URL" 2>/dev/null); then
              END_TIME=$(date +%s%N)
              ELAPSED_TIME=$(echo "scale=3; ($END_TIME - $START_TIME) / 1000000000" | bc)
              SUCCESS=true
              RESPONSE_TIME=$(echo $response | jq -r '.time_total // "0"')
              HTTP_CODE=$(echo $response | jq -r '.http_code // "000"')
              echo "âœ… æˆåŠŸï¼å“åº”æ—¶é—´: ${RESPONSE_TIME}s, HTTPçŠ¶æ€ç : $HTTP_CODE"
              echo "status=success" >> $GITHUB_OUTPUT
              echo "response_time=$RESPONSE_TIME" >> $GITHUB_OUTPUT
              echo "http_code=$HTTP_CODE" >> $GITHUB_OUTPUT
              echo "attempt=$attempt" >> $GITHUB_OUTPUT
              response_time_ms=$(echo "$RESPONSE_TIME * 1000" | bc | cut -d. -f1)
              if [ "$response_time_ms" -gt 10000 ] 2>/dev/null; then
                echo "::warning::âš ï¸ ç©ºé—´ [${{ matrix.space.name }}] å“åº”ç¼“æ…¢ï¼Œè€—æ—¶: ${RESPONSE_TIME}s"
                echo "performance=slow" >> $GITHUB_OUTPUT
              else
                echo "performance=normal" >> $GITHUB_OUTPUT
              fi
              break
            else
              echo "::warning::âŒ å°è¯• #$attempt å¤±è´¥"
              if [ $attempt -lt 3 ]; then
                echo "ç­‰å¾…5ç§’åé‡è¯•..."
                sleep 5
              fi
            fi
          done
          if [ "$SUCCESS" = "false" ]; then
            echo "status=failure" >> $GITHUB_OUTPUT
            echo "::error::âŒ ç©ºé—´ ${{ matrix.space.name }} å¥åº·æ£€æŸ¥å¤±è´¥"
          fi

      - name: å¤±è´¥åæ·±åº¦é‡è¯•
        id: retry
        if: steps.health_check.outputs.status == 'failure'
        continue-on-error: true
        run: |
          echo "ğŸ”„ å¼€å§‹æ·±åº¦é‡è¯•..."
          sleep 10
          RETRY_SUCCESS=false
          for i in $(seq 1 ${{ env.RETRY_ATTEMPTS }}); do
            echo "ğŸ” æ·±åº¦é‡è¯• $i/${{ env.RETRY_ATTEMPTS }}"
            for method in "GET" "HEAD"; do
              echo "å°è¯• $method è¯·æ±‚..."
              if curl -X $method -sSf --max-time 30 --connect-timeout 10 \
                -H "User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36" \
                -H "Accept: */*" \
                "${{ matrix.space.url }}" > /dev/null 2>&1; then
                echo "âœ… ä½¿ç”¨ $method æ–¹æ³•åœ¨ç¬¬ $i æ¬¡é‡è¯•æ—¶æ¢å¤æ­£å¸¸"
                RETRY_SUCCESS=true
                echo "retry_status=success" >> $GITHUB_OUTPUT
                echo "retry_method=$method" >> $GITHUB_OUTPUT
                echo "retry_attempt=$i" >> $GITHUB_OUTPUT
                break 2
              fi
            done
            if [ $i -lt ${{ env.RETRY_ATTEMPTS }} ]; then
              echo "ç­‰å¾…10ç§’..."
              sleep 10
            fi
          done
          if [ "$RETRY_SUCCESS" = "false" ]; then
            echo "::error::âŒ é‡è¯•åç©ºé—´ä»ç„¶æ— å“åº”"
            echo "retry_status=failure" >> $GITHUB_OUTPUT
          fi

      - name: æ·±åº¦æ¿€æ´»è¯·æ±‚
        id: activation
        if: steps.health_check.outputs.status == 'success' || steps.retry.outputs.retry_status == 'success'
        continue-on-error: true
        run: |
          echo "ğŸš€ å‘é€æ·±åº¦æ¿€æ´»è¯·æ±‚..."
          URL="${{ matrix.space.url }}"
          ACTIVATED_PATHS=""
          paths=("/" "/docs" "/api" "/health" "/status" "/api/health" "/?__theme=light" "")
          for path in "${paths[@]}"; do
            full_url="${URL}${path}"
            echo "ğŸ“ æ¿€æ´»è·¯å¾„: $full_url"
            if curl -sSf --max-time 10 \
              -H "User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36" \
              -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8" \
              -H "Accept-Language: en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7" \
              -H "Accept-Encoding: gzip, deflate, br" \
              -H "DNT: 1" \
              -H "Connection: keep-alive" \
              -H "Upgrade-Insecure-Requests: 1" \
              -H "Cache-Control: max-age=0" \
              "$full_url" > /dev/null 2>&1; then
              echo "âœ… æˆåŠŸæ¿€æ´»: $path"
              ACTIVATED_PATHS="${ACTIVATED_PATHS}${path} "
            else
              echo "âš ï¸ æ— æ³•è®¿é—®: $path"
            fi
            sleep 1
          done
          echo "activated_paths=$ACTIVATED_PATHS" >> $GITHUB_OUTPUT
          echo "ğŸ“Š æ¿€æ´»å®Œæˆ"

      - name: ç”ŸæˆçŠ¶æ€æŠ¥å‘Š
        id: report
        if: always()
        run: |
          if [ "${{ steps.health_check.outputs.status }}" = "success" ]; then
            FINAL_STATUS="âœ… å¥åº·"
            STATUS_EMOJI="âœ…"
            STATUS_COLOR="32CD32"
          elif [ "${{ steps.retry.outputs.retry_status }}" = "success" ]; then
            FINAL_STATUS="âš ï¸ é‡è¯•åæ¢å¤"
            STATUS_EMOJI="âš ï¸"
            STATUS_COLOR="FFA500"
          else
            FINAL_STATUS="âŒ å¼‚å¸¸"
            STATUS_EMOJI="âŒ"
            STATUS_COLOR="DC143C"
          fi
          echo "final_status=$FINAL_STATUS" >> $GITHUB_OUTPUT
          echo "status_emoji=$STATUS_EMOJI" >> $GITHUB_OUTPUT
          echo "status_color=$STATUS_COLOR" >> $GITHUB_OUTPUT

      - name: è®°å½•è¯¦ç»†æŒ‡æ ‡
        if: always()
        run: |
          TIMESTAMP=$(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S CST')
          cat << EOF >> $GITHUB_STEP_SUMMARY
          ## ${{ steps.report.outputs.status_emoji }} ç©ºé—´ç›‘æ§æŠ¥å‘Š: \`${{ matrix.space.name }}\`
          ### ğŸ“Š åŸºæœ¬ä¿¡æ¯
          | æŒ‡æ ‡ | å€¼ |
          |------|-----|
          | **ç©ºé—´åç§°** | ${{ matrix.space.name }} |
          | **URL** | [${{ matrix.space.url }}](${{ matrix.space.url }}) |
          | **æœ€ç»ˆçŠ¶æ€** | ${{ steps.report.outputs.final_status }} |
          | **æ£€æŸ¥æ—¶é—´** | ${TIMESTAMP} |
          | **è§¦å‘æ–¹å¼** | ${{ github.event_name == 'workflow_dispatch' && 'æ‰‹åŠ¨è§¦å‘' || 'å®šæ—¶è§¦å‘' }} |
          ### ğŸ” æ£€æŸ¥è¯¦æƒ…
          | æŒ‡æ ‡ | å€¼ |
          |------|-----|
          | **åˆæ¬¡æ£€æŸ¥** | ${{ steps.health_check.outputs.status == 'success' && 'âœ… æˆåŠŸ' || 'âŒ å¤±è´¥' }} |
          | **å“åº”æ—¶é—´** | ${{ steps.health_check.outputs.response_time || 'N/A' }}s |
          | **HTTPçŠ¶æ€ç ** | ${{ steps.health_check.outputs.http_code || 'N/A' }} |
          | **æ€§èƒ½çŠ¶æ€** | ${{ steps.health_check.outputs.performance == 'slow' && 'ğŸŒ ç¼“æ…¢' || 'ğŸš€ æ­£å¸¸' }} |
          | **æˆåŠŸå°è¯•** | ç¬¬ ${{ steps.health_check.outputs.attempt || 'N/A' }} æ¬¡ |
          ### ğŸ”„ é‡è¯•ä¿¡æ¯
          | æŒ‡æ ‡ | å€¼ |
          |------|-----|
          | **é‡è¯•çŠ¶æ€** | ${{ steps.retry.outputs.retry_status == 'success' && 'âœ… æˆåŠŸ' || steps.retry.outputs.retry_status == 'failure' && 'âŒ å¤±è´¥' || 'â– æœªæ‰§è¡Œ' }} |
          | **é‡è¯•æ–¹æ³•** | ${{ steps.retry.outputs.retry_method || 'N/A' }} |
          | **é‡è¯•æ¬¡æ•°** | ${{ steps.retry.outputs.retry_attempt || 'N/A' }} |
          ### ğŸš€ æ¿€æ´»è¯¦æƒ…
          | æŒ‡æ ‡ | å€¼ |
          |------|-----|
          | **æ¿€æ´»æ‰§è¡Œ** | ${{ steps.activation.outcome == 'success' && 'âœ… å®Œæˆ' || steps.activation.outcome == 'skipped' && 'â­ï¸ è·³è¿‡' || 'âŒ å¤±è´¥' }} |
          | **æ¿€æ´»è·¯å¾„** | ${{ steps.activation.outputs.activated_paths || 'N/A' }} |
          ---
          EOF

  summary:
    needs: [prepare, monitor_spaces]
    runs-on: ubuntu-latest
    if: always()
    permissions:
      issues: write
      contents: read
    steps:
      - name: æ”¶é›†ç›‘æ§ç»“æœ
        id: collect
        run: |
          echo "ğŸ“Š æ­£åœ¨ç”Ÿæˆç›‘æ§æ€»ç»“..."
          if [ "${{ contains(needs.monitor_spaces.result, 'failure') }}" = "true" ]; then
            echo "has_failures=true" >> $GITHUB_OUTPUT
            echo "overall_status=âš ï¸ éƒ¨åˆ†ç©ºé—´å­˜åœ¨é—®é¢˜" >> $GITHUB_OUTPUT
            echo "status_color=warning" >> $GITHUB_OUTPUT
          else
            echo "has_failures=false" >> $GITHUB_OUTPUT
            echo "overall_status=âœ… æ‰€æœ‰ç©ºé—´è¿è¡Œæ­£å¸¸" >> $GITHUB_OUTPUT
            echo "status_color=success" >> $GITHUB_OUTPUT
          fi
          echo "timestamp=$(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S CST')" >> $GITHUB_OUTPUT
          echo "next_run_time=$(TZ='Asia/Shanghai' date -d '+6 hours' '+%Y-%m-%d %H:%M:%S CST')" >> $GITHUB_OUTPUT
          echo "trigger_type=${{ github.event_name }}" >> $GITHUB_OUTPUT

      - name: ç”Ÿæˆç›‘æ§æ€»ç»“æŠ¥å‘Š
        run: |
          cat << 'SUMMARY_EOF' >> $GITHUB_STEP_SUMMARY
          # ğŸ¯ HF ç©ºé—´ç›‘æ§æ€»ç»“
          ## ğŸ“ˆ æ€»ä½“çŠ¶æ€
          **${{ steps.collect.outputs.overall_status }}**
          ## â° æ—¶é—´ä¿¡æ¯
          - **æ‰§è¡Œæ—¶é—´**: ${{ steps.collect.outputs.timestamp }}
          - **ä¸‹æ¬¡è¿è¡Œ**: ${{ steps.collect.outputs.trigger_type == 'workflow_dispatch' && 'æ‰‹åŠ¨è§¦å‘' || steps.collect.outputs.next_run_time }}
          - **è§¦å‘æ–¹å¼**: ${{ steps.collect.outputs.trigger_type == 'workflow_dispatch' && 'ğŸ”§ æ‰‹åŠ¨è§¦å‘' || 'â° å®šæ—¶è§¦å‘' }}
          ## ğŸ“‹ ç›‘æ§çš„ç©ºé—´åˆ—è¡¨
          ${{ needs.prepare.outputs.spaces_list }}
          ## ğŸ“Š ç›‘æ§ç»Ÿè®¡
          - **ç›‘æ§é¢‘ç‡**: æ¯ 6 å°æ—¶ (åŒ—äº¬æ—¶é—´ 9:00, 15:00, 21:00, 03:00)
          - **è¶…æ—¶è®¾ç½®**: ${{ env.TIMEOUT_SECONDS }} ç§’
          - **é‡è¯•æ¬¡æ•°**: ${{ env.RETRY_ATTEMPTS }} æ¬¡
          - **è°ƒè¯•æ¨¡å¼**: ${{ inputs.debug_mode && 'ğŸ” å·²å¯ç”¨' || 'å…³é—­' }}
          ## ğŸ”” é€šçŸ¥è®¾ç½®
          - **å¤±è´¥é€šçŸ¥**: ${{ steps.collect.outputs.has_failures == 'true' && 'å°†åˆ›å»º Issue é€šçŸ¥' || 'æ— éœ€é€šçŸ¥' }}
          - **ç›‘æ§çŠ¶æ€**: ğŸŸ¢ ç³»ç»Ÿæ­£å¸¸è¿è¡Œ
          ---
          ### ğŸ’¡ æç¤º
          - æ‰€æœ‰ç©ºé—´éƒ½ä¼šè¿›è¡Œæ·±åº¦æ¿€æ´»ä»¥ä¿æŒæ´»è·ƒçŠ¶æ€
          - å“åº”æ—¶é—´è¶…è¿‡ 10 ç§’çš„ç©ºé—´ä¼šè¢«æ ‡è®°ä¸º"ç¼“æ…¢"
          - å¤±è´¥çš„ç©ºé—´ä¼šè‡ªåŠ¨è¿›è¡Œå¤šæ¬¡é‡è¯•
          ### ğŸ”§ é…ç½®è¯´æ˜
          - ä¿®æ”¹ç›‘æ§åˆ—è¡¨ï¼šç¼–è¾‘ `env.SPACES_TO_MONITOR` å˜é‡
          - è°ƒæ•´æ£€æŸ¥é¢‘ç‡ï¼šä¿®æ”¹ `schedule.cron` è¡¨è¾¾å¼ (å½“å‰ä¸ºåŒ—äº¬æ—¶é—´)
          - æ›´æ”¹è¶…æ—¶æ—¶é—´ï¼šè°ƒæ•´ `env.TIMEOUT_SECONDS` å€¼
          ---
          *æ­¤æŠ¥å‘Šç”± GitHub Actions è‡ªåŠ¨ç”Ÿæˆ - ä½¿ç”¨åŒ—äº¬æ—¶é—´*
          SUMMARY_EOF

      - name: åˆ›å»ºå¤±è´¥é€šçŸ¥Issue
        if: steps.collect.outputs.has_failures == 'true' && github.event_name != 'workflow_dispatch'
        continue-on-error: true
        uses: actions/github-script@v7
        with:
          script: |
            const now = new Date();
            const beijingTime = new Date(now.getTime() + (8 * 60 * 60 * 1000));
            const date = beijingTime.toISOString().split('T')[0];
            const time = beijingTime.toISOString().split('T')[1].split('.')[0];
            const spaces_list = `${{ needs.prepare.outputs.spaces_list }}`;
            console.log('ğŸ”” å‡†å¤‡åˆ›å»ºé€šçŸ¥Issue...');
            try {
              const recentIssues = await github.rest.issues.listForRepo({
                owner: context.repo.owner,
                repo: context.repo.repo,
                labels: 'space-health',
                state: 'open',
                per_page: 10
              });
              const todayIssue = recentIssues.data.find(issue => 
                issue.title.includes(date)
              );
              if (todayIssue) {
                console.log(`ğŸ“ ä»Šæ—¥å·²æœ‰å‘Šè­¦Issue #${todayIssue.number}ï¼Œæ·»åŠ è¯„è®º...`);
                await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: todayIssue.number,
                  body: `## ğŸ”„ æ›´æ–°æŠ¥å‘Š - ${time} CST\n\nç›‘æ§ç³»ç»Ÿåœ¨ ${time} CST (åŒ—äº¬æ—¶é—´) å†æ¬¡æ£€æµ‹åˆ°ç©ºé—´å¼‚å¸¸ã€‚\n\n[æŸ¥çœ‹è¯¦ç»†æ—¥å¿—](${context.serverUrl}/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId})\n\n---\n*è‡ªåŠ¨æ›´æ–°äº ${date} ${time} CST*`
                });
                console.log('âœ… å·²æ›´æ–°ç°æœ‰Issue');
              } else {
                console.log('ğŸ“ åˆ›å»ºæ–°çš„å‘Šè­¦Issue...');
                const issueBody = `## âš ï¸ HF Space å¥åº·æ£€æŸ¥è­¦æŠ¥
            ### ğŸ• æ£€æµ‹æ—¶é—´
            ${date} ${time} CST (åŒ—äº¬æ—¶é—´)
            ### ğŸ“Š ç›‘æ§æŠ¥å‘Š
            éƒ¨åˆ† HuggingFace Space æœªèƒ½é€šè¿‡å¥åº·æ£€æŸ¥ã€‚
            ### ğŸ“‹ ç›‘æ§çš„ç©ºé—´
            ${spaces_list}
            ### ğŸ” å¯èƒ½çš„åŸå› 
            - Space å¤„äºä¼‘çœ çŠ¶æ€
            - ç½‘ç»œè¿æ¥é—®é¢˜
            - Space é…ç½®é”™è¯¯
            - HuggingFace å¹³å°é—®é¢˜
            ### ğŸ’¡ å»ºè®®æ“ä½œ
            1. æŸ¥çœ‹ [Actions æ—¥å¿—](${context.serverUrl}/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId}) äº†è§£è¯¦æƒ…
            2. æ‰‹åŠ¨è®¿é—®å¤±è´¥çš„ Space æ£€æŸ¥çŠ¶æ€
            3. å¦‚æœé—®é¢˜æŒç»­ï¼Œè€ƒè™‘é‡å¯ Space
            ### ğŸ“ˆ ç›‘æ§ä¿¡æ¯
            - **æ£€æŸ¥æ—¶é—´**: ${date} ${time} CST (åŒ—äº¬æ—¶é—´)
            - **å·¥ä½œæµè¿è¡ŒID**: ${context.runId}
            - **è§¦å‘æ–¹å¼**: ${{ github.event_name }}
            ---
            *æ­¤ Issue ç”± HF ç©ºé—´ç›‘æ§å™¨è‡ªåŠ¨åˆ›å»ºã€‚å¦‚æœé—®é¢˜å·²è§£å†³ï¼Œè¯·æ‰‹åŠ¨å…³é—­æ­¤ Issueã€‚*`;
                const issue = await github.rest.issues.create({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  title: `[ç›‘æ§å‘Šè­¦] HF Space å¥åº·æ£€æŸ¥å¼‚å¸¸ - ${date}`,
                  body: issueBody,
                  labels: ['automated', 'space-health', 'alert', `status:${context.job.status}`]
                });
                console.log(`âœ… å·²åˆ›å»ºIssue #${issue.data.number}`);
              }
            } catch (error) {
              console.error('âŒ åˆ›å»º/æ›´æ–°Issueæ—¶å‡ºé”™:', error.message);
              console.error('é”™è¯¯è¯¦æƒ…:', error);
            }

      - name: ç”Ÿæˆå¾½ç« æ•°æ®
        if: always()
        continue-on-error: true
        run: |
          STATUS_COLOR="${{ steps.collect.outputs.status_color }}"
          STATUS_TEXT="${{ steps.collect.outputs.has_failures == 'true' && 'unhealthy' || 'healthy' }}"
          echo "## çŠ¶æ€å¾½ç« " >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "[![HF Spaces Status](https://img.shields.io/badge/HF%20Spaces-${STATUS_TEXT}-${STATUS_COLOR})](${GITHUB_SERVER_URL}/${GITHUB_REPOSITORY}/actions/workflows/${GITHUB_WORKFLOW})" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "å°†ä¸Šè¿°å¾½ç« ä»£ç æ·»åŠ åˆ° README.md å¯å®æ—¶æ˜¾ç¤ºç›‘æ§çŠ¶æ€" >> $GITHUB_STEP_SUMMARY
